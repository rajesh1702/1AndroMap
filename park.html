
<!DOCTYPE PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<link href="styles.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" charset="utf-8" src="cordova-2.0.0.js"></script>
   
<script type="text/javascript" charset="utf-8" src="jquery.js"></script>
        <script type="text/javascript" charset="utf-8" src="geolocation.js"></script>
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.0/jquery.min.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.9/jquery-ui.min.js"></script>
<link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.9/themes/base/jquery-ui.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">
var userlatcoord, userlongcoord;
var deviceready = false;
var loopingagain = false;

function initialize()
       {
            //alert('initialize is called');
            document.addEventListener("deviceready", onDeviceReady, false);
         console.log('initialize() is called');
      // latitude 53.1, longitude = -2.3
    }
  
  
function onDeviceReady()
{
 deviceready = true;
 console.log('onDeviceReady() is called');
}

 $(document).ready(function(){

 console.log('First self-executing function executing');
initialize();
  var mapOptions = {
       zoom: 10,
       mapTypeId: google.maps.MapTypeId.ROADMAP,
       center: new google.maps.LatLng(53.1,-2.3)
     };


 console.log('Initialised the map');

  var map = new google.maps.Map(document.getElementById("map"),mapOptions);
 
  var geocoder = new google.maps.Geocoder();


     $(function() {
   
      console.log('Second self-executing function executing');
         $("#searchbox").autocomplete({
     
           source: function(request, response) {

          if (geocoder == null){
           geocoder = new google.maps.Geocoder();
          }
             geocoder.geocode( {'address': request.term }, function(results, status) {
               if (status == google.maps.GeocoderStatus.OK) {

                  var searchLoc = results[0].geometry.location;
               var lat = results[0].geometry.location.lat();
                  var lng = results[0].geometry.location.lng();
                  var latlng = new google.maps.LatLng(lat, lng);
                  var bounds = results[0].geometry.bounds;

                  geocoder.geocode({'latLng': latlng}, function(results1, status1) {
                      if (status1 == google.maps.GeocoderStatus.OK) {
                        if (results1[1]) {
                         response($.map(results1, function(loc) {
                        return {
                            label  : loc.formatted_address,
                            value  : loc.formatted_address,
                            bounds   : loc.geometry.bounds
                          }
                        }));
                        }
                      }
                    });
            }
              });
           },
           select: function(event,ui){
      var pos = ui.item.position;
      var lct = ui.item.locType;
      var bounds = ui.item.bounds;
      if (bounds){
       map.fitBounds(bounds);
  
      }
           }
         });
     });
 });
</script>
 </head>
 <body onload="initialize()">
  <h1>Autocomplete Store Locator</h1>
  <div align="left">
   <input type="text" value="" id="searchbox" style=" width:320px;height:30px; font-size:15px;">
  </div>
  <div align="left" id="map" style="width:320px; height: 250px; margin-top: 10px;">
  </div>


 </body>
</html>
